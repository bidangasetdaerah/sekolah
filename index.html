<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Data Rekap Barang</title>

  <!-- Tailwind CSS -->
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- Bootstrap CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />
  <!-- Bootstrap Icons -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css" rel="stylesheet" />
</head>
<body class="bg-gray-100 p-6">

<div class="container mx-auto bg-white rounded-lg shadow-lg p-6">
  <h2 class="text-2xl font-bold mb-4 text-center">ðŸ“¦ Data Rekap Barang</h2>

  <div class="table-responsive">
    <table id="dataTable" class="table table-striped table-bordered align-middle text-center">
      <thead class="table-dark">
        <tr>
          <th>No</th>
          <th>Kode Barang</th>
          <th>Nama Barang</th>
          <th>Informasi Barang</th>
          <th>Tanggal Perolehan</th>
          <th>Harga Beli / Perolehan</th>
          <th>Keadaan Barang</th>
          <th>Foto</th>
          <th>Keterangan</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>
</div>

<!-- Modal Preview Foto -->
<div
  class="modal fade"
  id="fotoModal"
  tabindex="-1"
  aria-labelledby="fotoModalLabel"
  aria-hidden="true"
>
  <div class="modal-dialog modal-dialog-centered modal-lg">
    <div class="modal-content">
      <div class="modal-body text-center">
        <img
          id="fotoPreview"
          src=""
          alt="Foto Barang"
          class="img-fluid rounded shadow"
        />
      </div>
      <div class="modal-footer">
        <button
          type="button"
          class="btn btn-secondary"
          data-bs-dismiss="modal"
        >
          Tutup
        </button>
      </div>
    </div>
  </div>
</div>

<script>
  const url = "https://docs.google.com/spreadsheets/d/e/2PACX-1vRR3WkXKX8G72rPYfQeE5uy0fMO3SZB4WeWKJvaOWfly5gtQPgsWYFTV-jC1lzRsz7lvwQD5Dqd2NO6/pub?gid=1525579636&single=true&output=csv";

  fetch(url)
    .then((response) => response.text())
    .then((csv) => {
      const rows = csv
        .split("\n")
        .map((r) => r.split(/,(?=(?:(?:[^"]*"){2})*[^"]*$)/)); // split koma tapi abaikan koma dalam tanda petik
      const tableBody = document.querySelector("#dataTable tbody");

      for (let i = 1; i < rows.length; i++) {
        const row = rows[i];
        if (!row || row.length < 9) continue;

        let tr = document.createElement("tr");

        for (let j = 0; j <= 8; j++) {
          let td = document.createElement("td");
          let cell = (row[j] ?? "").replace(/(^"|"$)/g, "").trim();

          if (j === 7) {
            // Kolom Foto
            if (cell) {
              let btn = document.createElement("button");
              btn.className = "btn btn-link p-0";
              btn.title = "Lihat Foto";
              btn.innerHTML = '<i class="bi bi-camera-fill text-primary fs-4"></i>';
              btn.onclick = () => {
                document.getElementById("fotoPreview").src = cell;
                new bootstrap.Modal(document.getElementById("fotoModal")).show();
              };
              td.appendChild(btn);
            }
          } else {
            td.textContent = cell;
          }
          tr.appendChild(td);
        }
        tableBody.appendChild(tr);
      }
    })
    .catch((err) => console.error("Gagal mengambil data:", err));
</script>

<!-- Bootstrap JS Bundle -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

</body>
</html>
